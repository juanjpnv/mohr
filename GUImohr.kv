# -*- coding: utf-8 -*-
#=========================TELA PRINCIPAL===============================
<Principal>
    Menu:
        name: 'TelaInicial'
    TelaDoPlano:
        name: 'TelaDoPlano'
    TelaDoPlanoDeformacao
        name: 'TelaDoPlanoDeformacao'
    TelaTensaoTri:
        name: 'TelaTensaoTri'
#============================ TELA INICIO =============================
<Menu>
    BoxLayout:
        orientation: 'vertical'
        Label:
            size_hint_y: 0.5
            text: 'Análise de tensão deformação'
        BoxLayout:
            orientation: 'vertical'
            spacing: '40sp'
            padding: '40sp'
            Button:
                on_release: root.manager.current = 'TelaDoPlano'
                text: 'Estado Plano de Tensão'
            Button:
                text: 'Estado Plano de Deformação'
                on_release: root.manager.current = 'TelaDoPlanoDeformacao'
            Button:
                text: 'Estado Triaxial de Tensão'
                on_release: root.manager.current = 'TelaTensaoTri'

#=========================== TELA DO PLANO ============================
<TelaDoPlano>
    BoxLayout:
        orientation: 'vertical'
        ActionBar:
            ActionView:
                ActionPrevious:
                    title: 'Plano de Tensão'
                    on_release: root.manager.current = 'TelaInicial'
        BoxLayout:
            orientation:'horizontal'
            BoxLayout:
                size_hint: 0.3, 1
                orientation: 'vertical'
                InserirValores
                    unidade: ' MPa'
                    tipo: 'tensao'
                    simbolos: ['σx', 'σy', 'τxy']
                    id: inserirvalor
                    size_hint: 1, 0.5
                SistemaSlide:
                    id: sistemaslide
                    simbolos: ['θ', 'σx', 'σy', 'τxy']
                    unidade: ' MPa'
            BoxLayout:
                orientation: 'vertical'
                SaidaValores
                    unidade: ' MPa'
                    simbolos: ['σ1', 'σ2', 'τmax', 'σmed']
                    id: saidavalor
                    size_hint: 1, .5
                WidgetGrafico:
                    tipo: 'tensao'
                    id: grafico

#==================== TELA DO PLANO DE DEFORMAÇÃO =====================
<TelaDoPlanoDeformacao>
    BoxLayout:
        orientation: 'vertical'
        ActionBar:
            ActionView:
                ActionPrevious:
                    title: 'Estado Plano de Deformação'
                    on_release: root.manager.current = 'TelaInicial'
        BoxLayout:
            orientation:'horizontal'
            BoxLayout:
                size_hint: 0.3, 1
                orientation: 'vertical'
                InserirValores
                    tipo: 'deform'
                    unidade: ' μm/mm'
                    simbolos: ['εx', 'εy', 'γxy']
                    id: inserirvalor
                    size_hint: 1, 0.5
                SistemaSlide:
                    id: sistemaslide
                    unidade: ' μm/mm'
                    simbolos: ['θ', 'εx', 'εy', 'γxy']
            BoxLayout:
                orientation: 'vertical'
                SaidaValores:
                    tipo: 'deform'
                    unidade: ' μm/mm'
                    simbolos: ['ε1', 'ε2', 'γmax', 'εmed']
                    size_hint: 1, 0.5
                    id: saidavalor
                WidgetGrafico:
                    tipo: 'deform'
                    id: grafico

#==================== MÓDULOS DAS TELAS =====================
<InserirValores>
    pai: root.parent.parent.parent.parent.ids
    cols: 2
    Label:
        id: label_tensaoX
        text: root.simbolos[0]
    TextInput:
        id: entra_X
        text: ''
        multiline: False
        write_tab: False
    Label:
        id: label_tensaoY
        text: root.simbolos[1]
    TextInput:
        id: entra_Y
        text: ''
        multiline: False
        write_tab: False
    Label:
        id: label_cisalhante
        text: root.simbolos[2]
    TextInput:
        id: entra_cis
        text: ''
        multiline: False
        write_tab: False
    Button:
        id: botao_calcular
        text: 'Calcular'
        on_press: root.calcular()
        on_release: root.pai.saidavalor.executa_saida_valores(*root.saida)
        on_release: root.pai.grafico.grafico_2d(*root.grafico); root.pai.sistemaslide.pegar_valores(*root.entrada)
    Button:
        id: botao_limpar
        text: 'Limpar'
        on_press: root.limpar()
        on_release: root.pai.saidavalor.executa_saida_valores(*root.saida)
        on_release: root.pai.grafico.grafico_2d(*root.grafico); root.pai.sistemaslide.limpar()

<SaidaValores>
    cols: 2
    Label:  # Label de tensão principal
        text: 'Tensões Principais'
        size_hint: 1, 2/7
    Label:  # Label de cisalhamento principal
        text: 'Plano de Cisalhamento Máximo'
        size_hint: 1, 2/7
    BoxLayout:
        GridLayout:
            cols: 2
            Label:
                text: root.simbolos[0]
            Label:
                id: result_x
                text: '- '+root.unidade
                halign: 'right'
            Label:
                text: root.simbolos[1]
            Label:
                id: result_y
                text: '- '+root.unidade
                halign: 'right'
            Label:
                text: 'θ1' # theta 1 | angulo 1
            Label:
                id: result_ang
                text: '- º' # º
                halign: 'right'
            Label:
                text: 'θ2' # theta 2 | angulo 2
            Label:
                id: result_ang2
                text: '- º' # º
                halign: 'right'
        Elemento:
            source: 'Imagens/EstadoPlano.png'
            id: elemento1 # Maxima Tensao/Deformação Normal

    BoxLayout:
        GridLayout:
            cols: 2
            Label:
                text: root.simbolos[2]
            Label:
                id: result_cis
                text: '- '+root.unidade
                halign: 'right'
            Label:
                text: root.simbolos[3]
            Label:
                id: result_med
                text: '- '+root.unidade
                halign: 'right'
            Label:
                text: 'θs'
            Label:
                id: result_ang3
                text: '- º'
                halign: 'right'
        Elemento:
            source: 'Imagens/EstadoPlano.png'
            id: elemento2 # Máxima Tensão/Deformação Cisalhante

#======================== TELA TENSÃO TRIAXIAL ========================
<TelaTensaoTri>
    BoxLayout:
        orientation: 'vertical'
        ActionBar:
            ActionView:
                ActionPrevious:
                    title: 'Estado Triaxial de Tensão'
                    on_release: root.manager.current = 'TelaInicial'
        BoxLayout:
            size_hint: 1, .3
            orientation: 'horizontal'
            Label:
                size_hint: .1,1
                text: 'σ = '
            InserirTensaoTri:
                id: entra__tri
            SaidaTensaoTri:
                id: saida_tensao_tri
        WidgetGrafico:
            id: grafico_tensao_3D
            tipo: 'tensao'

#------------------------------------------------------------------------------------
<InserirTensaoTri>
        #sx: Stress X - sy: Stress Y - sz: Stress Z
        #txy: Shear XY - tyx: Shear YZ - tzx: Shear ZX"""
    cols: 3
    TextInput:
        text: 'σxx'
        multiline: False
        id: entra_X
        write_tab: False
    TextInput:
        text: 'τxy'
        multiline: False
        id: entra_cisXY
        write_tab: False
    TextInput:
        text: 'τxz'
        multiline: False
        id: entra_cisXZ
        write_tab: False

    Label:
        text: root.ids.entra_cisXY.text
    TextInput:
        text: 'σyy'
        multiline: False
        write_tab: False
        id: entra_Y
    TextInput:
        text: 'τyz'
        multiline: False
        write_tab: False
        id: entra_cisYZ

    Label:
        text: root.ids.entra_cisXZ.text
    Label:
        text: root.ids.entra_cisYZ.text
    TextInput:
        text: 'σzz'
        multiline: False
        write_tab: False
        id: entra_Z
    Button:
        text: 'Calcular'
        on_press: root.calcular()
        on_release: app.root.get_screen('TelaTensaoTri').ids.saida_tensao_tri.imprime_principais(*root.saida)
        on_release: app.root.get_screen('TelaTensaoTri').ids.grafico_tensao_3D.grafico_3d(*root.grafico)
    Button:
        text: 'Limpar'
        on_release: root.limpar()
        on_release: app.root.get_screen('TelaTensaoTri').ids.grafico_tensao_3D.grafico_3d(0,0,0,0,0,0)
        on_press: app.root.get_screen('TelaTensaoTri').ids.saida_tensao_tri.imprime_principais('0','0','0','0','0','0')

#------------------------------------------------------------------------------------
<SaidaTensaoTri>
    cols: 1
    BoxLayout:
        id: caixa_resposta_triaxial
        orientation: 'horizontal'
        BoxLayout:
            orientation: 'vertical'
            Label:
                text: 'σ1'
                id: label_result_s1
            Label:
                text: 'σ2'
                id: label_result_s2
            Label:
                text: 'σ3'
                id: label_result_s3
        BoxLayout:
            orientation: 'vertical'
            Label:
                text: 'τ13'
                id: label_result_t13
            Label:
                text: 'τ12'
                id: label_result_t12
            Label:
                text: 'τ23'
                id: label_result_t23

#=========================== OUTROS WIDGETS============================
<Elemento@Plano>
    #imagem do Plano De Saida -> imagem_pds
    canvas.before:
        PushMatrix
        Rotate:
            angle: root.angle
            origin: self.center
    canvas.after:
        PopMatrix
        Color:
            rgba: 1,1,1,1
        Line:
            bezier: (*self.center, self.center_x+0.3*self.height, self.center_y)
        Line:
            circle: (*self.center, 0.1*root.height, 90, -root.angle+90) #desenha angulo principal 1.

<SistemaSlide>
    orientation: 'vertical'
    BoxLayout:
        orientation: 'vertical'
        GridLayout:
            size_hint: 1, 1
            cols:2
            Label:
                text: root.simbolos[0]
            Label:
                text: str(root.valor)
            Label:
                text: root.simbolos[1]
            Label:
                id: lbl_sx
                text: str(root.sx_) + root.unidade
            Label:
                text: root.simbolos[2]
            Label:
                id: lbl_sy
                text: str(root.sy_) + root.unidade
            Label:
                text: root.simbolos[3]
            Label:
                id: lbl_txy
                text: str(root.txy_) + root.unidade
        Elemento:
            source: 'Imagens/EstadoPlano.png'
            id: plano
            angle: root.valor
    Slider:
        size_hint: 1, .3
        id: desliza
        min: 0
        max: 180
        on_value: root.valor = round(self.value, 3); root.rotacao_plano()